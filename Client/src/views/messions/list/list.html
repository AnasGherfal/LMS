<v-card class="pa-6">
    <v-card-item>
        <v-row>
            <v-card-title class="d-flex align-center">
                {{pageTitle}}
            </v-card-title>
            <v-spacer></v-spacer>
            <v-tooltip text="إضافة مهمة"  v-if="identity.user.roleId == 1">
                <template v-slot:activator="{ props }">
                    <v-btn v-bind="props" variant="outlined" icon="mdi-file-document-plus-outline" @click="create" />
                </template>
            </v-tooltip>
        </v-row>
        <v-row>
            <v-col md="3">
                <text-field label="عنوان المهمة"
                            v-model="filter.title"
                            @update:model-value="getAll()"
                            clearable>
                </text-field>
            </v-col>
            <v-col md="3">
                <auto-complete label="الجهة المكلفة"
                               v-model="filter.entityId"
                               :items="lookups.entitiesLookup"
                               clearable
                               @update:model-value="getAll()">
                </auto-complete>
            </v-col>
            <v-col md="3">
                <auto-complete label="حالة الإنجاز"
                               v-model="filter.status"
                               :items="missionStatusLookup"
                               clearable
                               @update:model-value="getAll()">
                </auto-complete>
            </v-col>
        </v-row>
    </v-card-item>
    <v-card-text>
        <v-data-table :headers="headers" :items="messions">
            <template v-slot:item.entity="{ item }">
                <v-tooltip location="top">
                    <template v-slot:activator="{ props }">
                        <span v-bind="props">{{noteTruncate(item.entity, 15)}}</span>
                    </template>
                    <span>{{item.entity}}</span>
                </v-tooltip>
            </template>
            <template v-slot:item.status="{ item }">
                <v-chip :color="item.status == 0 ? 'warning' : 'green'"
                        :text="item.status == 1 ? 'منجزة' : 'قيد الإجراء'"
                        label
                        size="small"></v-chip>
            </template>
            <template v-slot:item.actions="{ item }">

                <v-tooltip location="top">
                    <template v-slot:activator="{ props }">
                        <v-btn icon v-bind="props" variant="text"
                               @click="view(item.id)">
                            <v-icon size="small" color="primary">mdi-eye-outline</v-icon>
                        </v-btn>
                    </template>
                    <span>عرض تفاصيل المهمة</span>
                </v-tooltip>

                <v-tooltip location="top" v-if="item.status == 0 ">
                    <template v-slot:activator="{ props }">
                        <v-btn icon v-bind="props" variant="text"
                               @click="showDialog(item.id)">
                            <v-icon size="small" color="green">mdi-check</v-icon>
                        </v-btn>
                    </template>
                    <span>تم الإنجاز</span>
                </v-tooltip>

            </template>
        </v-data-table>
        <v-pagination v-model="filter.pageNo"
                      class="my-4"
                      :length="totalPages"></v-pagination>
    </v-card-text>





    <v-dialog v-model="doneDialog"
              persistent
              width="600">
        <v-card>
            <v-card-title>
                حذف مستخدم
            </v-card-title>
            <v-card-text>
                <span>هل أنت متأكد من إتمام انجاز المهمة</span>
            </v-card-text>
            <v-card-actions>
                <v-spacer></v-spacer>
                <v-btn color="primary"
                       variant="text"
                       @click="done">
                    اتمام
                </v-btn>
                <v-btn color="error"
                       variant="text"
                       @click="canceleDialog()">
                    الغاء
                </v-btn>
            </v-card-actions>
        </v-card>
    </v-dialog>
</v-card>
